<!DOCTYPE html>

<html>
<head>
  <title>require_tree</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1>require_tree</h1>
<p>(c)2013 Van Carney
Licensed under the MIT License</p>
<h3>Recursive Package like Module and JSON Loading for NodeJS</h3>
<p>A partial port of Backbone.Events for event binding/triggering</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Events =</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h3>on(name, callback, context)</h3>
<blockquote>
<p>Adds an event listener</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="literal">on</span>: (name, callback, context)-&gt;
    <span class="keyword">return</span> @ <span class="keyword">if</span>  !eventsApi( @, <span class="string">'on'</span>, name, [callback, context]) || !callback
    <span class="property">@_events</span> || (<span class="property">@_events</span> = {})
    events = <span class="property">@_events</span>[name] || (<span class="property">@_events</span>[name] = [])
    events.push callback: callback, context: context, ctx: context || @
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h3>off(name, callback, context)</h3>
<blockquote>
<p>Removes an event listener</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="literal">off</span>: (name, callback, context)-&gt;
    <span class="keyword">return</span> @ <span class="keyword">if</span> !<span class="property">@_events</span> || !eventsApi(@, <span class="string">'off'</span>, name, [callback, context])
    <span class="keyword">if</span> (!name &amp;&amp; !callback &amp;&amp; !context)
      <span class="property">@_events</span> = {};
      <span class="keyword">return</span> @
    <span class="function"><span class="title">keys</span></span> = (o)-&gt;
      a = []
      <span class="keyword">for</span> n,x <span class="keyword">of</span> o
        a.push n
      a
    <span class="keyword">for</span> ord,name <span class="keyword">of</span> (names = <span class="keyword">if</span> name <span class="keyword">then</span> [name] <span class="keyword">else</span> keys <span class="property">@_events</span>)
      <span class="keyword">if</span> (events = <span class="property">@_events</span>[name]) 
        <span class="property">@_events</span>[name] = retain = []
        <span class="keyword">if</span> (callback || context)
          <span class="keyword">for</span> evt <span class="keyword">of</span> events
            console.log evt
            retain.push evt <span class="keyword">if</span> (callback &amp;&amp; callback != evt.callback) &amp;&amp; (callback != evt.callback._callback) || (context &amp;&amp; context != evt.context)
        <span class="keyword">delete</span> <span class="property">@_events</span>[name] <span class="keyword">if</span> !retain.length     
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h3>trigger(name, ...)</h3>
<blockquote>
<p>Dispatches an event </p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>  trigger: (name)-&gt;
    <span class="keyword">return</span> @ <span class="keyword">if</span> !<span class="property">@_events</span>
    args = [].slice.call arguments, <span class="number">1</span>
    <span class="keyword">return</span> @ <span class="keyword">if</span> !eventsApi @, <span class="string">'trigger'</span>, name, args
    events    = <span class="property">@_events</span>[name]
    allEvents = <span class="property">@_events</span>.all
    triggerEvents events, args <span class="keyword">if</span> events
    triggerEvents allEvents, arguments <span class="keyword">if</span> allEvents
    @
eventSplitter = <span class="regexp">/\s+/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h3>eventsApi(name, callback, context)</h3>
<blockquote>
<p>Implementation of Backbone&#39;s eventsAPI</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">eventsApi</span></span> = (obj, action, name, rest)-&gt;
  <span class="keyword">return</span> <span class="literal">true</span> <span class="keyword">if</span> !name
  <span class="keyword">if</span> <span class="keyword">typeof</span> name == <span class="string">'object'</span>
    <span class="keyword">for</span> key <span class="keyword">of</span> name
      obj[action].apply obj, [key, name[key]].concat rest
    <span class="literal">false</span>
  <span class="keyword">if</span> eventSplitter.test name
    names = name.split eventSplitter
    <span class="keyword">for</span> idx <span class="keyword">of</span> names
      obj[action].apply obj, [names[idx]].concat rest
    <span class="literal">false</span>
  <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h3>triggerEvents(events, args)</h3>
<blockquote>
<p>Implementation of Backbone&#39;s triggerEvents</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">triggerEvents</span></span> = (events, args)-&gt;
  i = -<span class="number">1</span>
  l = events.length
  a1 = args[<span class="number">0</span>]
  a2 = args[<span class="number">1</span>]
  a3 = args[<span class="number">2</span>]
  <span class="keyword">switch</span> (args.length)
    <span class="keyword">when</span> <span class="number">0</span>
      <span class="keyword">while</span> (++i &lt; l) 
        (ev = events[i]).callback.call(ev.ctx) 
      <span class="keyword">return</span>
    <span class="keyword">when</span> <span class="number">1</span>
      <span class="keyword">while</span> (++i &lt; l) 
        (ev = events[i]).callback.call(ev.ctx, a1) 
      <span class="keyword">return</span>
    <span class="keyword">when</span> <span class="number">2</span>
      <span class="keyword">while</span> (++i &lt; l) 
        (ev = events[i]).callback.call(ev.ctx, a1, a2)
      <span class="keyword">return</span>
    <span class="keyword">when</span> <span class="number">3</span>
      <span class="keyword">while</span> (++i &lt; l) 
        (ev = events[i]).callback.call(ev.ctx, a1, a2, a3)
      <span class="keyword">return</span>
    <span class="keyword">else</span>
      <span class="keyword">while</span> (++i &lt; l) 
        (ev = events[i]).callback.apply(ev.ctx, args)</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>supports <code>bind</code> usage</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Events.bind   = Events.<span class="literal">on</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>supports <code>unbind</code> usage</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Events.unbind = Events.<span class="literal">off</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h3>require_tree(uPath, [options])</h3>
<blockquote>
<p>Loads given path hierarchy into package structure</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.<span class="function"><span class="title">require_tree</span></span> = (uPath, options={})-&gt;
  <span class="string">'use strict'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>define locals for access by loaded Child Modules</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  module.exports.locals = options.locals || {}
  fs    = require <span class="string">'fs'</span>
  path  = require <span class="string">'path'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>retrieves all but the last value of a given array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="title">initial</span></span> = (a)-&gt; a.splice <span class="number">0</span>, a.length - <span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>composites two or more Objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="title">extend</span></span> = (obj)-&gt;
    <span class="keyword">for</span> o <span class="keyword">in</span> Array.prototype.slice.call arguments, <span class="number">1</span>
      <span class="keyword">if</span> o?
        <span class="keyword">for</span> x <span class="keyword">of</span> o
          obj[x] = o[x]
    obj
  extend @, Events</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>a local version of dirname thatwill replace path &#39;.&#39; with and empty string for internal use</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="title">dirname</span></span> = (p)-&gt;
    (path.dirname p).replace <span class="regexp">/^\.+$/</span>, <span class="string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>clean up the uPath and set as the root path to the package we are importing -- we will use this to filter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _root = (uPath = path.normalize uPath ?= <span class="string">'.'</span>).split(path.sep).join path.sep</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Our packages object that we will build and return </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  module.exports.packages = packages = extend options.packages || {}, require_tree:{}</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>returns the path parts as an array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="title">parsePath</span></span> = (p)-&gt; p.replace(<span class="keyword">new</span> RegExp(<span class="string">"^\\.?(\\<span class="subst">#{path.sep}</span>)"</span>),<span class="string">''</span>).split path.sep</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>returns a path woth the _root filtered out</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="title">getPwd</span></span> = (p)-&gt;
    p.replace <span class="keyword">new</span> RegExp(<span class="string">"^(\\.\\<span class="subst">#{path.sep}</span>)?<span class="subst">#{(parsePath _root).join '\\'+path.sep}</span>\\<span class="subst">#{path.sep}</span>"</span>), <span class="string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>adds a given path to the Package</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="title">appendPackage</span></span> = (p)-&gt;
    pkg = packages
    <span class="keyword">for</span> d <span class="keyword">in</span> [<span class="number">0.</span>..(s=parsePath p).length]
      pkg[s[d]] ?= {}
      pkg = pkg[s[d]]
    pkg</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>get a Path from the Package</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="title">getPackage</span></span> = (p)-&gt;
    pkg = packages
    <span class="keyword">for</span> d <span class="keyword">in</span> [<span class="number">0.</span>..(s=parsePath p).length]
      <span class="keyword">if</span> (f=pkg[s[d]])?
        pkg = f
      <span class="keyword">else</span>
        <span class="keyword">return</span> <span class="literal">null</span> <span class="keyword">if</span> s[d].length
    pkg</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>traverse the given Path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="title">walker</span></span> = (dir)=&gt;
    <span class="keyword">if</span> (list = fs.readdirSync dir).length
      <span class="keyword">for</span> name <span class="keyword">in</span> list
        <span class="keyword">continue</span> <span class="keyword">if</span> name.match <span class="regexp">/^\./</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>full path to file</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        file = path.join dir, name</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>package path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        pwd = getPwd file
        <span class="keyword">try</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>attempt to get stats on the file</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          stat = fs.statSync file
        <span class="keyword">catch</span> e
          <span class="keyword">throw</span> <span class="keyword">new</span> Error e
          <span class="keyword">return</span> <span class="literal">false</span>
        <span class="keyword">if</span> stat?.isDirectory()</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>add this directory to our Package</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          appendPackage pwd</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>walk this directory</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          walker file
        <span class="keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>we only handle JS and JSON files</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="keyword">continue</span> <span class="keyword">if</span> !path.extname(file).match <span class="regexp">/^\.js+(on)?$/</span>
          <span class="keyword">try</span></pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>detect path formatting -- default is to ditch the filenames</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> !options.preserve_filenames</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>composite this Package (FYI: will join all.json and .js file contents into one package item)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="keyword">if</span> <span class="keyword">typeof</span> (x = require fs.realpathSync <span class="string">"<span class="subst">#{file}</span>"</span>) != <span class="string">'function'</span>
                o = extend (getPackage dirname pwd), x
              <span class="keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>if we have orphaned functions, we will ignore the directive and append the function with the filename</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                (m = {})[name.split(<span class="string">'.'</span>).shift()] = x
                o = extend (getPackage dirname pwd), m
            <span class="keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>then we keep file names in the package path structure</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="keyword">if</span> name.match <span class="regexp">/^index+/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>if we have an index, we will build this directly into the current package</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                o = getPackage ((p=parsePath pwd).slice <span class="number">0</span>, p.length - (<span class="keyword">if</span> p.length &gt; <span class="number">1</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span>) ).join path.sep</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>composite this Package (FYI: will join index.json and index.js into one package item)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                o = extend o, r = require fs.realpathSync <span class="string">"<span class="subst">#{file}</span>"</span> 
              <span class="keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>we will append a new Package for each unique file name (excluding ext)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                o = <span class="keyword">if</span> (o = getPackage dirname pwd)? <span class="keyword">then</span> o <span class="keyword">else</span> appendPackage (parsePath pwd).join path.sep</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>add the module or JSON structure to the current Package</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                v = extend o[name.split(<span class="string">'.'</span>).shift()] || {}, require fs.realpathSync <span class="string">"<span class="subst">#{file}</span>"</span>
                o[name.split(<span class="string">'.'</span>).shift()] = v
          <span class="keyword">catch</span> e
            <span class="keyword">throw</span> <span class="keyword">new</span> Error e
            <span class="keyword">return</span> <span class="literal">false</span>
    <span class="literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>packages getPackage method for consumptions by caller</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  packages.require_tree.getPackage =</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>exports getTree for loaded module consumptions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  exports.<span class="function"><span class="title">getTree</span></span> = (p)=&gt;
    getPackage <span class="string">"<span class="subst">#{(p ?= '.').replace /\./, path.sep}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>packages addTree method for consumptions by caller</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  packages.require_tree.addTree =</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>exports addTree for loaded module consumptions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  exports.<span class="function"><span class="title">addTree</span></span> = (p) =&gt;
    _oR = _root
    _root = initial(b = p.split path.sep).join path.sep
    packages[_ns = b] ?= (packages[_ns = b] = {})
    <span class="keyword">if</span> walker p
      _root = _oR</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>dispatches changed event with added tree</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="property">@trigger</span> <span class="string">'changed'</span>, {packages:packages, added:packages[b] || {}}</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>exports current packages</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">return</span> exports.packages = packages
    _root = _oR
    <span class="literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>packages extendTree method for consumptions by caller</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  packages.require_tree.extendTree =</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>exports extendTree for loaded module consumptions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  exports.<span class="function"><span class="title">extendTree</span></span> = (obj) =&gt;
    packages = extend packages, obj</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>dispatches changed event with added tree</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@trigger</span> <span class="string">'changed'</span>, {packages:packages, added:obj}</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>packages removeTree method for consumptions by caller</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  packages.require_tree.removeTree =</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>exports removeTree for loaded module consumptions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  exports.<span class="function"><span class="title">removeTree</span></span> = (p) =&gt;
    pkg = getPackage initial(s=p.replace(<span class="regexp">/\./g</span>,path.sep).split path.sep).join path.sep
    <span class="keyword">try</span>
      <span class="keyword">if</span> (rm = pkg[s[s.length-<span class="number">1</span>]])?</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>deletes the found tree</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">delete</span> pkg[s[s.length-<span class="number">1</span>]]</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>dispatches changed event with removed tree</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="property">@trigger</span> <span class="string">'changed'</span>, {packages:packages, removed:rm}
    <span class="keyword">catch</span> e
      <span class="keyword">throw</span> <span class="keyword">new</span> Error e</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>exports Event.on for module consumption</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  packages.require_tree.<span class="literal">on</span>  = exports.<span class="literal">on</span>  = <span class="property">@on</span></pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>exports Event.off for module consumption</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  packages.require_tree.<span class="literal">off</span> = exports.<span class="literal">off</span> = <span class="property">@off</span></pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>exports Event.trigger for module consumption</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  packages.require_tree.trigger = exports.trigger = <span class="property">@trigger</span></pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>walk the given path if uPath is set</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  walker uPath, <span class="literal">null</span>, <span class="literal">null</span> <span class="keyword">if</span> uPath?</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>dispatches &#39;complete&#39; event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="property">@trigger</span> <span class="string">'completed'</span>, packages</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>returns the packaged contents</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  packages</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
