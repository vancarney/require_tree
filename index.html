<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Require tree by vancarney</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Require tree</h1>
        <p>Package like Module Loading for NodeJS</p>

        <p class="view"><a href="https://github.com/vancarney/require_tree">View the Project on GitHub <small>vancarney/require_tree</small></a></p>
        <p class="view"><a href="https://npmjs.org/package/require_tree">View the Project's NPM Page <small>package/require_tree</small></a></p>
        <p class="view"><a href="docs/require_tree.html">View the Annotated Source </a></p>

        <ul>
          <li><a href="https://github.com/vancarney/require_tree/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/vancarney/require_tree/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/vancarney/require_tree">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        

<!-- === begin markdown block =====================================================

      generated by markdown 1.0.0 on Ruby 1.9.3 (2012-04-20) [x86_64-darwin12.0.0]
                on 2013-10-11 19:44:38 -0700 with Markdown engine kramdown (0.14.0)
                  using options { !to be done! }
  -->
<h1 id="requiretreepath-options">require_tree(path [,options])</h1>

<p>Recursive Package like Module and JSON Loading for NodeJS</p>

<p><a href="https://travis-ci.org/vancarney/require_tree"><img src="https://travis-ci.org/vancarney/require_tree.png" alt="Build Status" /></a></p>

<h2 id="installation">Installation</h2>
<pre><code>	npm install require_tree
</code></pre>

<h2 id="basic-usage">Basic Usage</h2>

<p>Given a directory structure as follows</p>

<pre><code>- lib/
	- models/
		- User.js
	- controllers/
		- Login.js
	- utils/
		- index.js
		- specialUtility.js
	- config.json
</code></pre>

<p>You can import all these in a single <code>require_tree</code> statement and access them via hash syntax like a traditional OO Package</p>

<pre><code> var app = require('require_tree').require_tree('lib');
 
 // models.User is now accessable
 var user  = new app.models.User();
 
 // JSON objects are accessed in the same manner
 var configVal = app.config.myValue;
 
 // index files are appended directly to the local root
 app.utils.myIndexFunction();
 
 // other files are appended within the same scope
 var util = new app.utils.specialUtility();
</code></pre>

<h2 id="options">Options</h2>

<p>the <code>options</code> object accepts two properties:</p>

<blockquote>
  <p><strong>preserve_filenames</strong>: A boolean value instructing require_tree to preserve the filename in the package path structure. The default value is <code>false</code></p>
</blockquote>

<blockquote>
  <p><strong>locals</strong>: A user defined JS Object that will be made avialable to loaded modules</p>
</blockquote>

<h2 id="passing-data">Passing Data</h2>

<p>By passing a JS Object to the <code>locals</code> param of the<code>options</code> object, you can set that Object for access from <code>module.parent.exports.locals</code> in your loaded Module’s scope.</p>

<p>index.js:
~~~
var myMods = require_tree(‘lib’, {locals:{“myArray”:[1,2,3,4]}});
~~~ </p>

<p>lib/myMod.js:
~~~
 var passedArray = module.parent.exports.locals.myArray;
 console.log(passedArray);
~~~</p>

<p><em>Note</em>: If you make nested <code>require_tree</code> calls  you will need to explicitely pass the <code>module.parent.exports.locals</code> and <code>module.parent.exports.packages</code> objects to the <code>locals</code> param of the options object for the nested call.
See the <code>Options</code> section above.</p>

<h2 id="building-data-structures">Building Data Structures</h2>

<p><code>require_tree</code> allows you to import JSON documents and treats each index file as a root element.
This functionality allows you to create multiple index and data files to selectively build complex JSON data sets from static files.</p>

<pre><code>- conf/
	- condition_1/
		- index.js
	- condition_2/
		- index.js
- lib/
	- config.js
- index.js
</code></pre>

<p>In the above diagram, we see a <code>configure.js</code> file and a <code>conf</code> structure.
The intent here is to have build a config file based on the user environment much as we would build an application config using a <code>configure</code> script</p>

<p>lib/config.js
~~~
(function(global)
{
	// attempt to get passed data from locals Object
	var conditionValue = module.parent.exports.locals.condition || 2;
	// use require_tree to load a given structure – note that we pass in the locals object in the options for the new sub-tree
	global.config = require(‘require_tree’).require_tree( ‘../conf/condition_’ +  conditionValue, {locals{module.parent.exports.locals}});
})(exports);
~~~</p>

<p>index.js:
~~~
config = require_tree(“lib”, {locals:{“condition”:2}});
// config will now contain the dynmically generated JS object structure
console.log(config);
~~~</p>

<h2 id="accessing-the-package-structure-from-loaded-modules">Accessing the Package Structure From Loaded Modules</h2>

<p>While <code>require_tree</code> returns the loaded package Structure to the caller, it can be very useful to be aware of the Package Structure from within a loaded module
<code>require_tree</code> exports the packages as <code>exports.packages</code> and can be accessed in the same manner as <code>locals</code> described above. </p>

<p>Try using the <code>module.parent.exports.packages</code> hash instead of <code>require</code> or further <code>require_tree</code> calls.</p>

<p>example:
~~~
(function(global)
{
	var otherObjectRef = module.parent.exports.packages.path.to.other.Object;
	global.myModule = function() {
		this.myRefInstance = new otherObjectRef();
	}
})(exports)</p>

<p>~~~</p>

<p><em>Note</em>: Each call to <code>require_tree</code> creates a new Module Scope, so any ‘sub-trees’ created will not be able to access the containing <code>require_tree</code> scope.
To get around this and allow dynamically loaded subtrees to access loaded packages and data, put your current <code>module.parent.exports.locals</code> and <code>module.parent.exports.packages</code> hashes into the <code>locals</code> param of the <code>options</code> hash.
Review the <code>Passing Data</code> section above for more info.</p>

<h2 id="what-next">What Next?</h2>

<p>With recursive Module loading the ability to pass data and to create programmaticly defined structures on the fly, it seems only logical to add in module defined flow control and introspection,
However, what those would mean for performance, usability and whether or not such features are appropriate for a module loader need some mulling over. So feel free to chime in with ideas, suggestions or pull requests.</p>
<!-- === end markdown block ===================================================== -->


      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/vancarney">vancarney</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-44783832-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>